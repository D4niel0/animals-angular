<section>
  <article class="bg-white/70 shadow-md rounded-md p-5 mt-5">
    <header class="mb-6 mt-4">
      <h1 class="font-chewy text-xl md:text-2xl font-semibold text-gray-900">
        Editar datos de perfil
      </h1>
    </header>
    @if(isLoading) {
    <app-paw-spinner></app-paw-spinner>
    } @else {
    <section class="mb-8">
      <app-profile-image
        [currentImageUrl]="currentProfileImage()"
        (imageUpdated)="onProfileImageUpdated($event)"
      ></app-profile-image>
    </section>

    <hr class="border-gray-200 mb-8" />

    <form
      [formGroup]="shelterForm"
      (ngSubmit)="onSubmit()"
      class="space-y-8"
      novalidate
    >
      <!-- Datos de la entidad -->
      <section class="space-y-4">
        <h2 class="text-lg font-medium text-gray-900">Datos de la entidad</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Nombre legal -->
          <div>
            <label
              for="legalName"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Nombre legal de la entidad</label
            >
            <input
              id="legalName"
              pInputText
              type="text"
              placeholder="Nombre legal de la entidad"
              formControlName="legalName"
              class="w-full"
              maxlength="150"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  shelterForm.get('legalName')?.invalid &&
                  shelterForm.get('legalName')?.touched
              }"
            />
            <small
              class="text-red-500 text-xs"
              *ngIf="
                shelterForm.get('legalName')?.invalid &&
                shelterForm.get('legalName')?.touched
              "
            >
              El nombre legal es obligatorio.
            </small>
          </div>

          <!-- CIF/NIF -->
          <div>
            <label
              for="taxId"
              class="block text-sm font-medium text-gray-700 mb-1"
              >CIF / NIF</label
            >
            <input
              id="taxId"
              pInputText
              type="text"
              formControlName="taxId"
              placeholder="CIF / NIF"
              class="w-full uppercase cursor-help"
              [disabled]="true"
              pTooltip="Si necesitas cambiar este dato, contacta con nosotros."
              tooltipPosition="bottom"
            />
          </div>

          <!-- Número de registro -->
          <div>
            <label
              for="registryNumber"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Número de registro</label
            >
            <input
              id="registryNumber"
              pInputText
              type="text"
              placeholder="Número de registro"
              formControlName="registryNumber"
              class="w-full cursor-help"
              pTooltip="Si necesitas cambiar este dato, contacta con nosotros."
              tooltipPosition="bottom"
              [disabled]="true"
            />
          </div>
        </div>
      </section>

      <hr class="border-gray-200" />

      <!-- Persona responsable -->
      <section class="space-y-4">
        <h2 class="text-lg font-medium text-gray-900">Persona responsable</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Nombre responsable -->
          <div>
            <label
              for="responsibleFullName"
              class="block text-sm font-medium text-gray-700 mb-1"
            >
              Nombre y apellidos de la persona responsable *
            </label>
            <input
              id="responsibleFullName"
              pInputText
              type="text"
              placeholder="Nombre y apellidos"
              formControlName="responsibleFullName"
              class="w-full"
              maxlength="100"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  shelterForm.get('responsibleFullName')?.invalid &&
                  shelterForm.get('responsibleFullName')?.touched
              }"
            />
            <small
              class="text-red-500 text-xs"
              *ngIf="
                shelterForm.get('responsibleFullName')?.invalid &&
                shelterForm.get('responsibleFullName')?.touched
              "
            >
              El nombre de la persona responsable es obligatorio.
            </small>
          </div>

          <!-- Cargo -->
          <div>
            <label
              for="responsibleRole"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Cargo dentro de la asociación *</label
            >
            <input
              id="responsibleRole"
              pInputText
              type="text"
              formControlName="responsibleRole"
              class="w-full"
              placeholder="Presidenta, secretario, voluntaria autorizada…"
              maxlength="60"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  shelterForm.get('responsibleRole')?.invalid &&
                  shelterForm.get('responsibleRole')?.touched
              }"
            />
            <small
              class="text-red-500 text-xs"
              *ngIf="
                shelterForm.get('responsibleRole')?.invalid &&
                shelterForm.get('responsibleRole')?.touched
              "
            >
              El cargo es obligatorio.
            </small>
          </div>
        </div>
      </section>

      <hr class="border-gray-200" />

      <!-- Contacto -->
      <section class="space-y-4">
        <h2 class="text-lg font-medium text-gray-900">Datos de contacto</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Teléfono -->
          <div>
            <label
              for="contactPhone"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Teléfono de contacto</label
            >
            <input
              id="contactPhone"
              pInputText
              type="tel"
              formControlName="contactPhone"
              class="w-full"
              appPhoneFormat
              placeholder="Ej. 600 123 456 o 91 123 45 67"
              [maxlength]="13"
            />
          </div>

          <!-- Email -->
          <div>
            <label
              for="contactEmail"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Correo electrónico *</label
            >
            <input
              id="contactEmail"
              pInputText
              type="email"
              formControlName="contactEmail"
              class="w-full cursor-help"
              placeholder="correo@protectoraxxx.org"
              [disabled]="true"
              pTooltip="Si necesitas cambiar este dato, contacta con nosotros."
              tooltipPosition="bottom"
            />
          </div>
        </div>
      </section>

      <hr class="border-gray-200" />

      <!-- Dirección -->
      <section class="space-y-4">
        <h2 class="text-lg font-medium text-gray-900">Dirección</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Ciudad -->
          <div>
            <label
              for="addressCity"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Ciudad *</label
            >
            <input
              id="addressCity"
              pInputText
              type="text"
              placeholder="Ciudad"
              formControlName="addressCity"
              class="w-full"
              maxlength="80"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  shelterForm.get('addressCity')?.invalid &&
                  shelterForm.get('addressCity')?.touched
              }"
            />
            <small
              class="text-red-500 text-xs"
              *ngIf="
                shelterForm.get('addressCity')?.invalid &&
                shelterForm.get('addressCity')?.touched
              "
            >
              La ciudad es obligatoria.
            </small>
          </div>

          <!-- Provincia -->
          <div>
            <label
              for="addressProvince"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Provincia *</label
            >
            <p-select
              id="addressProvince"
              [options]="provincesOptions"
              formControlName="addressProvince"
              optionLabel="label"
              optionValue="value"
              placeholder="Selecciona una provincia"
              class="w-full"
              [ngClass]="{
                'ng-invalid ng-dirty':
                  shelterForm.get('addressProvince')?.invalid &&
                  shelterForm.get('addressProvince')?.touched
              }"
            />
            <small
              class="text-red-500 text-xs"
              *ngIf="
                shelterForm.get('addressProvince')?.invalid &&
                shelterForm.get('addressProvince')?.touched
              "
            >
              La provincia es obligatoria.
            </small>
          </div>
        </div>
      </section>

      <hr class="border-gray-200" />

      <!-- Redes sociales -->
      <section class="space-y-4">
        <h2 class="text-lg font-medium text-gray-900">
          Redes sociales (opcional)
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Web -->
          <div>
            <label
              for="website"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Web</label
            >
            <input
              id="website"
              pInputText
              type="url"
              formControlName="website"
              class="w-full"
              placeholder="https://www.protectoraxxx.org"
            />
          </div>

          <!-- Facebook -->
          <div>
            <label
              for="facebook"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Facebook</label
            >
            <input
              id="facebook"
              pInputText
              type="url"
              formControlName="facebook"
              class="w-full"
              placeholder="https://www.facebook.com/tu-protectora"
            />
          </div>

          <!-- Instagram -->
          <div>
            <label
              for="instagram"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Instagram</label
            >
            <input
              id="instagram"
              pInputText
              type="url"
              formControlName="instagram"
              class="w-full"
              placeholder="https://www.instagram.com/tu-protectora"
            />
          </div>
        </div>
      </section>

      <!-- Botón enviar -->
      <div class="flex justify-end pt-4 border-t border-gray-200">
        <button
          pButton
          type="submit"
          [label]="buttonTitle()"
          class="px-6"
          [loading]="isLoadingEdit"
          [disabled]="
            shelterForm.invalid || shelterForm.pending || isLoadingEdit
          "
        ></button>
      </div>
    </form>
    <article class="bg-white/70 shadow-md rounded-md p-5 mt-5">
      <h2 class="text-lg font-medium text-gray-900 mb-4">Cambiar contraseña</h2>

      <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()">
        <div class="mb-4 w-full md:w-1/2">
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Contraseña actual
          </label>
          <p-password
            formControlName="currentPassword"
            placeholder="Contraseña actual"
            [toggleMask]="true"
            [feedback]="false"
            inputStyleClass="w-full"
            [ngClass]="{
              'ng-invalid ng-dirty':
                passwordForm.get('currentPassword')?.invalid &&
                passwordForm.get('currentPassword')?.touched
            }"
          ></p-password>
          <small
            class="text-red-500 text-xs"
            *ngIf="
              passwordForm.get('currentPassword')?.invalid &&
              passwordForm.get('currentPassword')?.touched
            "
          >
            La contraseña actual es obligatoria.
          </small>
        </div>

        <app-control-password
          [title]="'Nueva contraseña'"
          [password]="$any(passwordForm.get('newPassword'))"
          [confirmPassword]="$any(passwordForm.get('confirmNewPassword'))"
        ></app-control-password>

        <div class="flex justify-end pt-4">
          <button
            pButton
            type="submit"
            label="Actualizar contraseña"
            [loading]="isLoadingPassword"
            [disabled]="
              passwordForm.invalid || passwordForm.pending || isLoadingPassword
            "
          ></button>
        </div>
      </form>
    </article>
    }
  </article>
</section>

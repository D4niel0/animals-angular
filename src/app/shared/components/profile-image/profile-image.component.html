<div class="profile-image-container">
  <div class="image-wrapper">
    <div class="avatar-circle" [class.has-image]="currentImageUrl">
      <img
        *ngIf="currentImageUrl"
        [src]="currentImageUrl"
        alt="Imagen de perfil"
        class="profile-image"
      />
      <span *ngIf="!currentImageUrl" class="initials">
        {{ getInitials() }}
      </span>
    </div>

    <button
      pButton
      type="button"
      icon="pi pi-camera"
      class="p-button-rounded p-button-sm change-image-btn"
      (click)="onChangeImageClick(fileInput)"
      [loading]="isUploading"
      [disabled]="isUploading"
      pTooltip="Cambiar imagen de perfil"
      tooltipPosition="right"
    ></button>
  </div>

  <input
    #fileInput
    type="file"
    accept="image/*"
    class="hidden"
    (change)="onFileSelected($event)"
  />

  <p-dialog
    [(visible)]="cropperVisible"
    [modal]="true"
    [closable]="false"
    [style]="{ width: '500px', maxWidth: '100%' }"
    [draggable]="false"
    [resizable]="false"
  >
    <ng-template pTemplate="header">
      <span class="text-sm font-medium">Selecciona tu imagen de perfil</span>
    </ng-template>

    <div class="space-y-3">
      <image-cropper
        [imageChangedEvent]="imageChangedEvent"
        [maintainAspectRatio]="true"
        [aspectRatio]="1"
        [resizeToWidth]="300"
        [cropperMinWidth]="150"
        format="png"
        [roundCropper]="true"
        (imageCropped)="imageCropped($event)"
      ></image-cropper>

      <div class="text-xs text-gray-500">
        Ajusta la imagen dentro del círculo. Se guardará automáticamente al
        confirmar.
      </div>
    </div>

    <ng-template pTemplate="footer">
      <div class="flex justify-end gap-2">
        <button
          pButton
          type="button"
          label="Cancelar"
          class="p-button-text"
          (click)="onCropCancel()"
          [disabled]="isUploading"
        ></button>
        <button
          pButton
          type="button"
          label="Guardar imagen"
          [disabled]="!pendingPreviewUrl || isUploading"
          [loading]="isUploading"
          (click)="onCropConfirm()"
        ></button>
      </div>
    </ng-template>
  </p-dialog>
</div>
